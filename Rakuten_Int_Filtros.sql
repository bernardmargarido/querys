SELECT 
	DISTINCT(AY3.AY3_CODIGO),
	CAST(CAST(AY3.AY3_DESCEC AS BINARY) AS VARCHAR) CARDESC,
	( SELECT AY1.AY1_CATFIL FROM AY1010 AY1 WHERE AY1.AY1_SUBCAT = B4.B4_01CAT1 AND AY1.D_E_L_E_T_ = '' ) CATNV1,
	( SELECT AY1.AY1_CATFIL FROM AY1010 AY1 WHERE AY1.AY1_CODIGO = B4.B4_01CAT1 AND AY1.AY1_SUBCAT = B4.B4_01CAT2 AND AY1.D_E_L_E_T_ = '' ) CATNV2, 
	( SELECT AY1.AY1_CATFIL FROM AY1010 AY1 WHERE AY1.AY1_CODIGO = B4.B4_01CAT2 AND AY1.AY1_SUBCAT = B4.B4_01CAT3 AND AY1.D_E_L_E_T_ = '' ) CATNV3, 
	( SELECT AY1.AY1_CATFIL FROM AY1010 AY1 WHERE AY1.AY1_CODIGO = B4.B4_01CAT3 AND AY1.AY1_SUBCAT = B4.B4_01CAT4 AND AY1.D_E_L_E_T_ = '' ) CATNV4, 
	( SELECT AY1.AY1_CATFIL FROM AY1010 AY1 WHERE AY1.AY1_CODIGO = B4.B4_01CAT4 AND AY1.AY1_SUBCAT = B4.B4_01CAT5 AND AY1.D_E_L_E_T_ = '' ) CATNV5,
	B4.B4_COD,
	AY3.AY3_STATUS,
	AY3.AY3_OBRECO,
	AY3.R_E_C_N_O_ RECNOAY3
FROM 
	AY3010 AY3
	INNER JOIN AY5010 AY5 ON AY5.AY5_FILIAL = ' ' AND AY5_CODIGO = AY3.AY3_CODIGO AND AY5.D_E_L_E_T_ = '' 
	INNER JOIN SB4010 B4 ON B4.B4_FILIAL = ' ' AND B4.B4_COD = AY5.AY5_CODPRO AND B4.B4_XENVECO = '2' AND B4.B4_XUSAECO = 'S' AND B4.D_E_L_E_T_ = ''
WHERE 
	AY3.AY3_ENVECO = '1' AND 
	AY3.D_E_L_E_T_ = '' 
ORDER BY B4.B4_COD 



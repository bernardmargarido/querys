-- COMPRAS ECOMMERCE OU COM CODIGO DE CLIENTES NO LOJA
SELECT SA1.A1_COD,SA1.A1_LOJA,A1_CGC,SD2.D2_DOC,SD2.D2_SERIE,SUM(SD2.D2_TOTAL) TOTAL, Cast((SUM(SD2.D2_TOTAL) / 250) as INTEGER) QTDCUPOM
FROM SA1010 SA1
INNER JOIN SD2010 SD2 ON SD2.D2_CLIENTE = SA1.A1_COD AND SD2.D2_LOJA = SA1.A1_LOJA AND SD2.D2_EMISSAO BETWEEN '20120301' AND '20120331' AND SD2.D2_TIPO = 'N' AND SD2.D_E_L_E_T_ = ''
INNER JOIN SB1010 SB1 ON SB1.B1_COD = SD2.D2_COD AND SB1.B1_01CODMA = 'MZ' AND SB1.B1_GRUPO IN('500M','500F','500U') AND SB1.D_E_L_E_T_ = '' 
WHERE
--SA1.A1_COD BETWEEN '' AND 'ZZZZZZ' AND 
--SA1.A1_LOJA BETWEEN '' AND 'ZZ' AND 
SA1.A1_CGC IN('01220319899','08911199818') AND 
SA1.D_E_L_E_T_ = ''
GROUP BY SA1.A1_COD,SA1.A1_LOJA,A1_CGC,SD2.D2_DOC,SD2.D2_SERIE
HAVING SUM(SD2.D2_TOTAL) >= 250
ORDER BY A1_COD

-- COMPRAS REALIZADAS COM CLIENTE PADRAO E INFOMADO CPF 
SELECT SL1.L1_CGCCLI,SD2.D2_DOC,SD2.D2_SERIE,SUM(SD2.D2_TOTAL) TOTAL, Cast((SUM(SD2.D2_TOTAL) / 250) as INTEGER) QTDCUPOM
FROM SL1010 SL1
INNER JOIN SD2010 SD2 ON SD2.D2_DOC = SL1.L1_DOC AND SD2.D2_SERIE = SL1.L1_SERIE AND SD2.D2_EMISSAO BETWEEN '20120301' AND '20120331' AND SD2.D2_TIPO = 'N' AND SD2.D_E_L_E_T_ = ''
INNER JOIN SB1010 SB1 ON SB1.B1_COD = SD2.D2_COD AND SB1.B1_01CODMA = 'MZ' AND SB1.B1_GRUPO IN('500M','500F','500U') AND SB1.D_E_L_E_T_ = '' 
WHERE
SL1.L1_CGCCLI BETWEEN '' AND 'ZZZZZZZZZZZZZZ' AND
SL1.L1_CLIENTE = '000001' AND
SL1.L1_LOJA = '01' AND 
SL1.D_E_L_E_T_ = ''
GROUP BY SL1.L1_CGCCLI,SD2.D2_DOC,SD2.D2_SERIE
HAVING SUM(SD2.D2_TOTAL) >= 250
ORDER BY L1_CGCCLI

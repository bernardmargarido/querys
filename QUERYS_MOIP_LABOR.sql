-- TITULOS EM ABERTO 
SELECT 
	E1.* 
FROM 
	SE1040 E1 
	INNER JOIN SC5040 C5 ON C5.C5_FILIAL = E1.E1_FILIAL AND C5.C5_NUM = E1.E1_PEDIDO AND C5.C5_CONDPAG IN('C00','C01','C02','C03','C04','C05','C06','BOL') AND C5.D_E_L_E_T_ = ''
WHERE
	E1.E1_BAIXA = '' AND 
	E1.E1_SALDO > 0 AND 
	E1.D_E_L_E_T_ = ''
ORDER BY E1.E1_FILIAL,E1.E1_NUM,E1.E1_PREFIXO,E1.E1_PARCELA

-- TITULOS BAIXADOS SEM GERAR FATURA
SELECT 
	C5.C5_CONDPAG,
	E5.* 
FROM 
	SE1040 E1 
	INNER JOIN SC5040 C5 ON C5.C5_FILIAL = E1.E1_FILIAL AND C5.C5_NUM = E1.E1_PEDIDO AND C5.C5_CONDPAG IN('C00','C01','C02','C03','C04','C05','C06','BOL') AND C5.D_E_L_E_T_ = ''
	INNER JOIN SE5040 E5 ON E5.E5_FILIAL = E1.E1_FILIAL AND E5.E5_NUMERO = E1.E1_NUM AND E5.E5_PREFIXO = E1.E1_PREFIXO AND E5.E5_PARCELA = E1.E1_PARCELA AND E5.D_E_L_E_T_ = ''
WHERE
	E1.E1_BAIXA <> '' AND 
	E1.E1_TIPOLIQ = '' AND
	E1.D_E_L_E_T_ = ''
ORDER BY E1.E1_FILIAL,E1.E1_NUM,E1.E1_PREFIXO,E1.E1_PARCELA

-- TITULOS BAIXADOS SEM GERAR MOVIMENTAÇÃO BANCARIA
SELECT 
	C5.C5_CONDPAG,
	E1.* 
FROM 
	SE1040 E1 
	INNER JOIN SC5040 C5 ON C5.C5_FILIAL = E1.E1_FILIAL AND C5.C5_NUM = E1.E1_PEDIDO AND C5.C5_CONDPAG IN('C00','C01','C02','C03','C04','C05','C06','BOL') AND C5.D_E_L_E_T_ = ''
WHERE
	NOT EXISTS( 
				SELECT 
					E5.*
				FROM 
					SE5040 E5 
				WHERE 
					E5.E5_FILIAL = E1.E1_FILIAL AND 
					E5.E5_NUMERO = E1.E1_NUM AND 
					E5.E5_PREFIXO = E1.E1_PREFIXO AND 
					E5.E5_PARCELA = E1.E1_PARCELA AND 
					E5.D_E_L_E_T_ = '' 
				) AND
	E1.E1_BAIXA <> '' AND 
	E1.E1_NUMLIQ = '' AND 
	E1.E1_TIPOLIQ = '' AND
	E1.D_E_L_E_T_ = ''
ORDER BY E1.E1_FILIAL,E1.E1_NUM,E1.E1_PREFIXO,E1.E1_PARCELA

-- TITULOS MO
SELECT 
	E1.E1_FILIAL,
	E1.E1_NUM,
	E1.E1_EMISSAO,
	E1.E1_VENCREA,
	E1.E1_PREFIXO,
	E1.E1_PARCELA,
	E1.E1_SALDO
FROM 
	SE1040 E1
WHERE
	E1.E1_TIPO = 'MO' AND 
	E1.E1_PREFIXO = 'ECO' AND
	E1.E1_BAIXA = '' AND 
	E1.E1_SALDO > 0 AND
	E1.E1_VENCREA <= '20221205' AND 
	E1.D_E_L_E_T_ = ''
ORDER BY E1.E1_FILIAL,E1.E1_NUM,E1.E1_PREFIXO,E1.E1_PARCELA

-- MF EM ABERTO
SELECT 
	E1.E1_FILIAL,
	E1.E1_NUM,
	E1.E1_EMISSAO,
	E1.E1_VENCREA,
	E1.E1_PREFIXO,
	E1.E1_PARCELA,
	E1.E1_SALDO,
	E1.E1_DOCTEF
FROM 
	SE1040 E1
WHERE
	E1.E1_TIPO = 'MF' AND 
	E1.E1_PREFIXO = 'ECO' AND
	E1.E1_BAIXA = '' AND 
	E1.E1_SALDO > 0 AND
	E1.E1_VENCREA BETWEEN '20220101' AND  '20221231' AND  
	E1.D_E_L_E_T_ = ''
ORDER BY E1.E1_FILIAL,E1.E1_NUM,E1.E1_PREFIXO,E1.E1_PARCELA

-- MF EM ABERTO COM ZZU 
SELECT 
	E1.E1_FILIAL,
	E1.E1_NUM,
	E1.E1_EMISSAO,
	E1.E1_VENCREA,
	E1.E1_PREFIXO,
	E1.E1_PARCELA,
	E1.E1_SALDO,
	E1.E1_DOCTEF
FROM 
	SE1040 E1
	INNER JOIN ZZU040 ZZU ON ZZU.ZZU_FILIAL = E1.E1_FILIAL AND ( ZZU.ZZU_IDPAY = E1.E1_DOCTEF OR ZZU.ZZU_IDMOIP = E1.E1_DOCTEF ) AND 
	ZZU_PARCEL = CASE WHEN E1.E1_PARCELA = '' THEN '01' ELSE E1.E1_PARCELA END AND ZZU.D_E_L_E_T_ = ''
WHERE
	E1.E1_TIPO = 'MF' AND 
	E1.E1_PREFIXO = 'ECO' AND
	E1.E1_BAIXA = '' AND 
	E1.E1_SALDO > 0 AND
	E1.E1_VENCREA <= '20221205' AND
	--E1.E1_DOCTEF = 'PAY-LEQCV1CKZ2LY' AND
	E1.D_E_L_E_T_ = ''
ORDER BY E1.E1_FILIAL,E1.E1_NUM,E1.E1_PREFIXO,E1.E1_PARCELA

-- MF EM ABERTO SEM ZZU 
SELECT 
	E1.E1_FILIAL,
	E1.E1_NUM,
	E1.E1_EMISSAO,
	E1.E1_VENCREA,
	E1.E1_PREFIXO,
	E1.E1_PARCELA,
	E1.E1_SALDO,
	E1.E1_DOCTEF
FROM 
	SE1040 E1
WHERE
	NOT EXISTS(
		SELECT 
			* 
		FROM 
			ZZU040 ZZU 
		WHERE
			ZZU.ZZU_FILIAL = E1.E1_FILIAL AND 
			( ZZU.ZZU_IDPAY = E1.E1_DOCTEF OR ZZU.ZZU_IDMOIP = E1.E1_DOCTEF ) AND 
			ZZU_PARCEL = CASE WHEN E1.E1_PARCELA = '' THEN '01' ELSE E1.E1_PARCELA END AND 
			ZZU.D_E_L_E_T_ = ''
	) AND 
	E1.E1_TIPO = 'MF' AND 
	E1.E1_PREFIXO = 'ECO' AND
	E1.E1_BAIXA = '' AND 
	E1.E1_SALDO > 0 AND
	E1.E1_VENCREA <= '20221205' AND 
	E1.D_E_L_E_T_ = ''
ORDER BY E1.E1_FILIAL,E1.E1_NUM,E1.E1_PREFIXO,E1.E1_PARCELA



SELECT * FROM ZZU040 WHERE ZZU_IDPAY = 'PAY-LEQCV1CKZ2LY' AND D_E_L_E_T_ = ''
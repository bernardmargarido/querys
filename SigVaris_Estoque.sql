SELECT 
	CODSKU,
	DESCSKU,
	IDSKU,
	SALDO,
	RECNOSB2
FROM
(
	SELECT 
		B2.B2_COD CODSKU,
		B1.B1_DESC DESCSKU,
		B5.B5_XIDSKU IDSKU,
		B2.B2_QATU SALDO,
		B2.R_E_C_N_O_ RECNOSB2

	FROM
		SB2010 B2
		INNER JOIN SB1010 B1 ON B1.B1_FILIAL = '0101' AND B1.B1_COD = B2.B2_COD AND B1.B1_MSBLQL <> '1' AND B1.D_E_L_E_T_ = '' 
		INNER JOIN SB5010 B5 ON B5.B5_FILIAL = '0101' AND B5.B5_COD = B2.B2_COD AND B5.B5_XENVECO = '2' AND B5.B5_XENVSKU = '2' AND B5.B5_XUSAECO = 'S' AND B5.D_E_L_E_T_ = ''
	WHERE
		B2.B2_FILIAL = '0101' AND 
		B2.B2_LOCAL = '05' AND 
		B2.B2_MSEXP = '' AND 
		B2.D_E_L_E_T_ = ''

	UNION 

	SELECT 
		B2.B2_COD CODSKU,
		B1.B1_DESC DESCSKU,
		WS6.WS6_IDSKU IDSKU,
		B2.B2_QATU SALDO,
		B2.R_E_C_N_O_ RECNOSB2

	FROM
		SB2010 B2
		INNER JOIN SB1010 B1 ON B1.B1_FILIAL = '0101' AND B1.B1_COD = B2.B2_COD AND B1.B1_MSBLQL <> '1' AND B1.D_E_L_E_T_ = '' 
		INNER JOIN WS5010 WS5 ON WS5.WS5_FILIAL = ' ' AND WS5.WS5_USAECO = 'S' AND WS5.WS5_ENVECO = '2' AND WS5.D_E_L_E_T_ = ''
		INNER JOIN WS6010 WS6 ON WS6.WS6_FILIAL = ' ' AND WS6.WS6_CODPRD = WS5.WS5_CODPRD AND WS6_CODSKU = B2.B2_COD AND WS6.WS6_ENVECO = '2' AND WS6.D_E_L_E_T_ = ''
	WHERE
		B2.B2_FILIAL = '0101' AND 
		B2.B2_LOCAL = '05' AND 
		B2.B2_MSEXP = '' AND 
		B2.D_E_L_E_T_ = ''

) ESTOQUE
ORDER BY CODSKU
